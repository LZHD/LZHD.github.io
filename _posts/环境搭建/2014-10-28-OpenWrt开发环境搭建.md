---
layout : life
title : OpenWrt开发环境搭建
category : 环境搭建
duoshuo: true
date : 2014-10-28
---

******

<!-- more -->

    Cisco/Linksys在2003年发布了WRT54G这款无线路由器，同年有人发现它的IOS是基于Linux的，然而Linux是基于GPL许可证发布的，按照该许可证Cisco应该把WRT54G 的IOS的源代码公开。2003年3月，Cisco迫于公众压力公开了WRT54G的源代码。此后就有了一些基于Cisco源码的第三方路由器固件，OpenWrt就是其中的一个。
***********************************

 **OpenWrt的特点：**
    可扩展性好，可以在线安装您所需要的功能，目前有1000多个功能包可选；是一台完整的Linux工作站，文件系统可读可写，便于开发者学习和实践；现在有越来越多的Maker开始折腾OpenWrt，但作为一个Maker新手来讲，在网上还是很难找到一份系统的入门级资料。查找资料很辛苦，而且OpenWrt的门槛相对较高，希望这篇文章所提供的从零开始学**OpenWrt编译 + 刷机 +使用教程**能降低新手们的入门难度，当然，编译过程非必须，一般的路由都可找到可用的稳定固件直接刷机。

***********************************

## 第一部分：搭建编译环境

- 1、安装Ubuntu
- 2、逐条输入下列命令（及时验证是否安装成功）：

```shell

sudo apt-get install g++
sudo apt-get install libncurses5-dev
sudo apt-get install zlib1g-dev
sudo apt-get install bison
sudo apt-get install flex
sudo apt-get install unzip
sudo apt-get install autoconf
sudo apt-get install gawk
sudo apt-get install make
sudo apt-get install gettext
sudo apt-get install gcc
sudo apt-get install binutils
sudo apt-get install patch
sudo apt-get install bzip2
sudo apt-get install libz-dev
sudo apt-get install asciidoc
sudo apt-get install subversion
sudo apt-get install sphinxsearch
sudo apt-get install libtool
sudo apt-get install sphinx-common

```

至此编译环境搭建完成。

********************************************
## 第二部分：下载OpenWrt源码并编译
 
 OpenWrt源码分两种，一种是最新但不是最稳定的Trunk开发版，一种是最稳定的Backfire版，建议下载官方源码。下载前先在本地创建文件夹：

```sh
 mkdir openwrt
 sudo chmod 777 openwrt
 cd openwrt
```

**选择你想要的版本然后执行下载命令，下载结束会显示版本号：**

```sh
  git clone git://git.openwrt.org/14.07/openwrt.git
```

**添加软件扩展包，将feeds.conf.default修改为feeds.conf：**

```sh
 cp feeds.conf.default feeds.conf
```

**更新扩展，安装扩展：**

```sh
./scripts/feeds update -a
./scripts/feeds install -a
```

**注：如果不是刚下载的源码，为保持代码为最新状态，应定期运行svn update命令更新源码。**

**测试编译环境：**

```sh
make defconfig
```

到这里就可以开始编译自己的固件了。进入定制界面：

```
make menuconfig
```

如果一切正常，会出现一个配置菜单，可以选择要编译的固件平台（芯片类型）、型号，还能选择固件中要添加的功能和组件，配置好后保存并退出菜单即可。如果你想修改源码，应该在此步进行，如支持大容量Flash之类的修改，自己上网查到修改什么文件什么地方后，就在ubuntu图形界面上进去找到文件，双击打开文本编辑器修改保存。

**开始编译：**

```sh
 make
```

或者

```sh
 make V=99
```

或者

```sh
 make -j V=99
```

`make`是编译命令，`V=99`表示输出debug信息，`V`一定要大写，如果要让CPU全速编译，就加上 `-j` 参数，第一次编译最好不带`-j`参数。

********************************************************


